(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d8ecd78"],{"0a49":function(t,e,n){var r=n("9b43"),a=n("626a"),o=n("4bf8"),i=n("9def"),c=n("cd1c");t.exports=function(t,e){var n=1==t,s=2==t,l=3==t,u=4==t,f=6==t,d=5==t||f,p=e||c;return function(e,c,m){for(var h,v,_=o(e),y=a(_),b=r(c,m,3),k=i(y.length),g=0,j=n?p(e,k):s?p(e,0):void 0;k>g;g++)if((d||g in y)&&(h=y[g],v=b(h,g,_),t))if(n)j[g]=v;else if(v)switch(t){case 3:return!0;case 5:return h;case 6:return g;case 2:j.push(h)}else if(u)return!1;return f?-1:l||u?u:j}}},"15fd":function(t,e,n){"use strict";var r=n("d225"),a=n("b0b4"),o=n("308d"),i=n("6bb5"),c=n("4e2b"),s=n("9ab4"),l=n("60a3"),u=function(t){function e(){var t;return Object(r["a"])(this,e),t=Object(o["a"])(this,Object(i["a"])(e).apply(this,arguments)),t.formItem={source:"",database:"",textarea:"",backup:1,text:"",idc:"",table:"",assigned:"",delay:null,tp:0,row:1,name:"",isquery:2,ip:"",add:"",username:"",password:"",port:"",id:0},t.wordList=[],t.page_number=1,t.current=1,t.find={picker:[],user:"",valve:!1},t.query={user:"",department:"",valve:!1,username:"",computer_room:"",connection_name:""},t.table_data=[],t.testResults=[],t.validate_gen=!0,t.loading=!1,t.is_open=!1,t.group_list=[],t.group_props=[],t.edit_password=!1,t.savePassLoading=!1,t}return Object(c["a"])(e,t),Object(a["a"])(e,[{key:"cancel_password",value:function(){this.edit_password=!1}}]),e}(l["d"]);u=Object(s["a"])([Object(l["a"])({components:{}})],u),e["a"]=u},7514:function(t,e,n){"use strict";var r=n("5ca1"),a=n("0a49")(5),o="find",i=!0;o in[]&&Array(1)[o](function(){i=!1}),r(r.P+r.F*i,"Array",{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(o)},"828e":function(t,e,n){},"8ce9":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",[n("Card",[n("p",{attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"md-person"}}),t._v("\n        工单审核\n      ")],1),n("Row",[n("Col",{attrs:{span:"24"}},[n("Form",{attrs:{inline:""}},[n("FormItem",[n("Poptip",{attrs:{trigger:"hover",title:"提示",content:"此开关用于打开实时表格数据更新功能"}},[n("i-switch",{attrs:{size:"large"},on:{"on-change":t.refreshForm},model:{value:t.valve,callback:function(e){t.valve=e},expression:"valve"}},[n("span",{attrs:{slot:"open"},slot:"open"},[t._v("打开")]),n("span",{attrs:{slot:"close"},slot:"close"},[t._v("关闭")])])],1)],1),n("FormItem",[n("Input",{attrs:{placeholder:"账号名"},on:{"on-keyup":function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.queryData(e)}},model:{value:t.find.user,callback:function(e){t.$set(t.find,"user",e)},expression:"find.user"}})],1),n("FormItem",[n("DatePicker",{staticStyle:{width:"250px"},attrs:{format:"yyyy-MM-dd HH:mm",type:"datetimerange",placeholder:"请选择查询的时间范围",editable:!1},on:{"on-change":function(e){t.find.picker=e}},model:{value:t.find.picker,callback:function(e){t.$set(t.find,"picker",e)},expression:"find.picker"}})],1),n("FormItem",[n("Button",{attrs:{type:"success"},on:{click:t.queryData}},[t._v("查询")]),n("Button",{staticClass:"margin-left-10",attrs:{type:"primary"},on:{click:t.queryCancel}},[t._v("重置")])],1)],1),n("Table",{attrs:{border:"",columns:t.columns,data:t.tableData,stripe:""},scopedSlots:t._u([{key:"action",fn:function(e){var r=e.row;return[5!==r.Status||"perform"===t.auth?n("div",[2===r.Status||"perform"===t.auth&&5===r.Status?n("Button",{attrs:{type:"primary",size:"small",ghost:""},on:{click:function(e){return t.openOrder(r)}}},[t._v("审批\n                ")]):t._e(),1===r.Status||4===r.Status?n("Button",{attrs:{type:"success",size:"small",ghost:""},on:{click:function(e){return t.orderDetail(r)}}},[t._v("\n                  执行结果\n                ")]):t._e(),n("Poptip",{attrs:{confirm:"",title:"确定要中止该工单吗？",transfer:""},on:{"on-ok":function(e){return t.delayKill(r)}}},[3===r.Status&&"none"!==r.Delay?n("Button",{attrs:{type:"error",size:"small",ghost:""}},[t._v("\n                    延时工单中止\n                  ")]):t._e()],1),3===r.Status&&0===r.Type?n("Button",{staticClass:"margin-left-10",attrs:{ghost:"",size:"small",type:"warning"},on:{click:function(e){return t.timerOsc(r)}}},[t._v("osc进度\n                ")]):t._e()],1):t._e()]}},{key:"delay",fn:function(e){var r=e.row;return["none"!==r.Delay?n("span",[t._v(t._s(r.Delay))]):n("span",[t._v("无")])]}}])}),n("br"),n("Page",{attrs:{total:t.page_number,"show-elevator":"","page-size":20,current:t.current},on:{"on-change":t.refreshData,"update:current":function(e){t.current=e}}})],1)],1)],1)],1),n("audit_osc",{attrs:{is_open:t.is_osc},on:{cancel:t.oscClose}}),n("audit_detail",{attrs:{is_open:t.is_order,sql_columns:t.sql_columns,multi_list:t.multi_list,multi:t.multi},on:{cancel:t.cancel_detail,reject:t.rejectTo,agreed:t.agreedTo,perform:t.performTo}}),n("audit_reject",{attrs:{is_open:t.is_open},on:{post:t.rejectText,cancel:t.cancel_reject}})],1)},a=[],o=n("d225"),i=n("308d"),c=n("6bb5"),s=n("4e2b"),l=n("9ab4"),u=(n("ac6a"),n("7514"),n("6b54"),n("b0b4")),f=n("bc3a"),d=n.n(f),p=n("c622"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{on:{"on-ok":t.rejectText,"on-cancel":t.cancel},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("p",{staticStyle:{color:"#f60","font-size":"16px"},attrs:{slot:"header"},slot:"header"},[n("Icon",{attrs:{type:"information-circled"}}),n("span",[t._v("SQL工单驳回理由说明")])],1),n("Input",{attrs:{type:"textarea",autosize:{minRows:15,maxRows:15},placeholder:"请填写驳回说明"},model:{value:t.reject,callback:function(e){t.reject=e},expression:"reject"}})],1)},h=[],v=n("60a3"),_=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(i["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.reject="",t}return Object(s["a"])(e,t),Object(u["a"])(e,[{key:"rejectText",value:function(){var t=this;d.a.post("".concat(this.$config.url,"/audit/reject"),{text:this.reject,work:this.formItem.WorkId}).then(function(e){t.$config.notice(e.data),t.$emit("post")}).catch(function(e){t.$config.err_notice(t,e)})}},{key:"cancel",value:function(){this.$emit("cancel")}},{key:"open",get:function(){return this.is_open},set:function(t){}},{key:"formItem",get:function(){return this.$store.state.order_item}}]),e}(v["d"]);Object(l["a"])([Object(v["c"])({type:Boolean,required:!0,default:!1})],_.prototype,"is_open",void 0),_=Object(l["a"])([Object(v["a"])({components:{}})],_);var y=_,b=y,k=n("2877"),g=Object(k["a"])(b,m,h,!1,null,"079d5946",null),j=g.exports,O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{attrs:{width:"1000"},on:{"on-cancel":t.cancel},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("p",{staticStyle:{color:"#f60","font-size":"16px"},attrs:{slot:"header"},slot:"header"},[n("Icon",{attrs:{type:"information-circled"}}),n("span",[t._v("SQL工单详细信息")])],1),n("Form",{attrs:{"label-position":"right"}},[n("FormItem",{attrs:{label:"环境:"}},[n("span",[t._v(t._s(t.formItem.IDC))])]),n("FormItem",{attrs:{label:"连接名称:"}},[n("span",[t._v(t._s(t.formItem.Source))])]),n("FormItem",{attrs:{label:"数据库库名:"}},[n("span",[t._v(t._s(t.formItem.Base))])]),n("FormItem",{attrs:{label:"数据库表名:"}},[n("span",[t._v(t._s(t.formItem.Table))])]),n("FormItem",{attrs:{label:"定时执行:"}},[n("span",[t._v(t._s(t.formItem.Delay))])]),n("FormItem",{attrs:{label:"工单说明:"}},[n("span",[t._v(t._s(t.formItem.Text))])]),n("FormItem",[n("Table",{attrs:{columns:t.sql_columns,data:t.sql_data,"max-height":300}})],1),t.multi&&"admin"===t.auth?n("FormItem",{attrs:{label:"选择执行人:",required:""}},[n("Select",{staticStyle:{width:"20%"},model:{value:t.multi_name,callback:function(e){t.multi_name=e},expression:"multi_name"}},t._l(t.multi_list,function(e){return n("Option",{key:e.Username,attrs:{value:e.Username}},[t._v(t._s(e.Username))])}),1)],1):t._e()],1),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("Button",{attrs:{type:"warning",loading:t.loading},nativeOn:{click:function(e){return t.testTo()}}},[t.loading?n("span",[t._v("检测中")]):n("span",[t._v("检测sql")])]),n("Button",{attrs:{type:"error"},on:{click:function(e){return t.reject()}}},[t._v("驳回")]),t.multi?["admin"===t.auth?n("Button",{attrs:{type:"success",disabled:t.summit},on:{click:function(e){return t.agreed()}}},[t._v("同意")]):t._e(),"perform"===t.auth?n("Button",{attrs:{type:"success",disabled:t.summit},on:{click:function(e){return t.perform()}}},[t._v("执行")]):t._e()]:[n("Button",{attrs:{type:"success",disabled:t.summit},on:{click:function(e){return t.perform()}}},[t._v("执行")])]],2)],1)},w=[],I=(n("ac4d"),n("8a81"),function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(i["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.auth=sessionStorage.getItem("auth"),t.loading=!1,t.summit=!0,t.multi_name="",t}return Object(s["a"])(e,t),Object(u["a"])(e,[{key:"reject",value:function(){this.$emit("reject")}},{key:"agreed",value:function(){this.$emit("agreed",this.multi_name,this.formItem.WorkId)}},{key:"perform",value:function(){this.$emit("perform",this.formItem.WorkId)}},{key:"cancel",value:function(){this.$emit("cancel"),this.summit=!0}},{key:"testTo",value:function(){var t=this;this.loading=!0;var e="",n=!0,r=!1,a=void 0;try{for(var o,i=this.sql_data[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;e+=c.SQL}}catch(l){r=!0,a=l}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}var s=!1;1===this.formItem.Type&&(s=!0),d.a.put("".concat(this.$config.url,"/fetch/test"),{source:this.formItem.Source,database:this.formItem.Base,table:this.formItem.Table,sql:e,isDMl:s}).then(function(e){t.sql_data=e.data;var n=0;t.sql_data.forEach(function(t){0!==t.Level&&(n+=1)}),t.summit=0!==n,t.loading=!1}).catch(function(e){t.$config.err_notice(t,e)})}},{key:"open",get:function(){return this.is_open},set:function(t){}},{key:"formItem",get:function(){return this.$store.state.order_item}},{key:"sql_data",get:function(){return this.$store.state.order_sql},set:function(t){this.$store.state.order_sql=t}}]),e}(v["d"]));Object(l["a"])([Object(v["c"])({type:Boolean,required:!0,default:!1})],I.prototype,"is_open",void 0),Object(l["a"])([Object(v["c"])({type:Array,required:!0,default:!1})],I.prototype,"sql_columns",void 0),Object(l["a"])([Object(v["c"])({type:Boolean,required:!0,default:!1})],I.prototype,"multi",void 0),Object(l["a"])([Object(v["c"])({type:Array,required:!0,default:[]})],I.prototype,"multi_list",void 0),I=Object(l["a"])([Object(v["a"])({components:{}})],I);var $=I,x=$,S=Object(k["a"])(x,O,w,!1,null,"bf8e0bca",null),q=S.exports,D=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Modal",{attrs:{title:"OSC进度展示",closable:!1,"ok-text":"osc终止"},on:{"on-cancel":t.oscClose,"on-ok":t.oscKill},model:{value:t.open,callback:function(e){t.open=e},expression:"open"}},[n("Col",{attrs:{offset:"6"}},[n("i-circle",{attrs:{size:250,"trail-width":4,"stroke-width":5,percent:t.osc.percent,"stroke-linecap":"square","stroke-color":"#43a3fb"}},[n("div",{staticClass:"demo-Circle-custom"},[n("h1",[t._v(t._s(t.osc.percent)+"%")]),n("span",[t._v("\n              当前正在执行第\n              "),n("i",[t._v(t._s(t.osc.current))]),t._v("\n            条\n          ")])])])],1)],1)},T=[],B=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(i["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.osc={percent:0,current:0},t.ws=0,t}return Object(s["a"])(e,t),Object(u["a"])(e,[{key:"oscClose",value:function(){clearInterval(this.ws),this.$emit("cancel")}},{key:"oscKill",value:function(){var t=this;d.a.delete("".concat(this.$config.url,"/audit/fetch_osc/").concat(this.work_id)).then(function(e){t.$config.notice(e.data),t.oscClose()}).catch(function(e){t.$config.err_notice(t,e),t.oscClose()})}},{key:"openOSC",value:function(){var t=this;this.open&&d.a.get("".concat(this.$config.url,"/audit/fetch_osc/").concat(this.work_id)).then(function(e){t.osc.percent=e.data.p,t.osc.current=e.data.s}).catch(function(e){return t.$config.err_notice(t,e)})}},{key:"mounted",value:function(){var t=this;this.ws=setInterval(function(){t.openOSC()},3e3)}},{key:"open",get:function(){return this.is_open},set:function(t){}},{key:"work_id",get:function(){return this.$store.state.osc_id}}]),e}(v["d"]);Object(l["a"])([Object(v["c"])({type:Boolean,required:!0,default:!1})],B.prototype,"is_open",void 0),B=Object(l["a"])([Object(v["a"])({components:{}})],B);var C=B,F=C,E=Object(k["a"])(F,D,T,!1,null,"16f779b9",null),W=E.exports,z=n("15fd"),L=function(t){function e(){var t;return Object(o["a"])(this,e),t=Object(i["a"])(this,Object(c["a"])(e).apply(this,arguments)),t.columns=[{title:"工单编号:",key:"WorkId",sortable:!0,sortType:"desc",width:155},{title:"工单说明:",key:"Text",tooltip:!0},{title:"是否备份",key:"Backup",width:100},{title:"提交时间:",key:"Date",sortable:!0},{title:"提交账号",key:"Username",sortable:!0},{title:"真实姓名",key:"RealName",sortable:!0},{title:"定时执行",key:"Delay",slot:"delay"},{title:"执行人",key:"Executor",sortable:!0},{title:"状态",key:"Status",width:150,render:function(t,e){var n=e.row,r="",a="";return 2===n.Status?(r="primary",a="待审核"):0===n.Status?(r="error",a="驳回"):1===n.Status?(r="success",a="执行成功"):4===n.Status?(r="error",a="执行失败"):5===n.Status?(r="default",a="待执行"):(r="warning",a="执行中"),t("Tag",{props:{type:"dot",color:r}},a)},sortable:!0},{title:"操作",key:"action",width:200,align:"center",slot:"action"}],t.sql_columns=[{type:"expand",width:50,render:function(t,e){return t(p["a"],{props:{row:e.row}})}},{title:"当前检查的sql",key:"SQL",render:function(t,e){var n=e.row.SQL.substring(0,40)+"...";return t("span",n)}},{title:"阶段",key:"Status",width:"150"},{title:"错误等级",key:"Level",width:"100"},{title:"错误信息",key:"Error",tooltip:!0},{title:"影响行数",key:"AffectRows",width:"120"}],t.tableData=[],t.multi=!1,t.multi_list=[],t.auth=sessionStorage.getItem("auth"),t.reboot=0,t.valve=!0,t.is_order=!1,t.is_osc=!1,t}return Object(s["a"])(e,t),Object(u["a"])(e,[{key:"delayKill",value:function(t){var e=this;d.a.get("".concat(this.$config.url,"/audit/kill/").concat(t.WorkId)).then(function(t){e.$config.notice(t.data),e.refreshData()}).catch(function(t){return e.$config.err_notice(e,t)})}},{key:"timerOsc",value:function(t){this.is_osc=!0,this.$store.commit("fetch_order_osc_id",t.WorkId)}},{key:"oscClose",value:function(){this.is_osc=!1}},{key:"openOrder",value:function(t){var e=this;d.a.get("".concat(this.$config.url,"/audit/sql?k=").concat(t.WorkId)).then(function(n){var r={WorkId:t.WorkId,IDC:n.data.idc,Source:n.data.source,Delay:n.data.delay,Base:n.data.base,Text:n.data.text,Table:n.data.table,Type:n.data.type};e.$store.commit("fetch_order_item",r),e.$store.commit("fetch_order_sql",n.data.sql),e.is_order=!0}).catch(function(t){e.$config.err_notice(e,t)})}},{key:"agreedTo",value:function(t,e){var n=this;""===t?this.$Message.error("请选择执行人!"):d.a.post("".concat(this.$config.url,"/audit/refer/perform"),{perform:t,WorkId:e}).then(function(t){n.$config.notice(t.data),n.is_order=!1,n.refreshData(n.current)}).catch(function(t){n.$config.err_notice(n,t)})}},{key:"performTo",value:function(t){var e=this;this.is_order=!1,d.a.post("".concat(this.$config.url,"/audit/execute"),{workid:t}).then(function(t){e.$config.notice(t.data),e.refreshData(e.current)}).catch(function(t){e.$config.err_notice(e,t)})}},{key:"rejectTo",value:function(){this.is_open=!this.is_open,this.is_order=!this.is_order}},{key:"rejectText",value:function(){this.is_open=!this.is_open,this.refreshData(this.current)}},{key:"cancel_reject",value:function(){this.is_open=!1}},{key:"cancel_detail",value:function(){this.is_order=!1}},{key:"orderDetail",value:function(t){this.$router.push({name:"order_detail",query:{workid:t.WorkId,status:t.Status.toString()}})}},{key:"refreshData",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;d.a.put("".concat(this.$config.url,"/audit"),{page:e,find:this.find}).then(function(e){if(t.multi=e.data.multi,!t.multi)for(var n=0;n<t.columns.length;n++)"Executor"===t.columns[n].key&&t.columns.splice(n,1);t.tableData=e.data.data,t.tableData.forEach(function(t){1===t.Backup?t.Backup="是":t.Backup="否"}),t.page_number=e.data.page,t.multi_list=e.data.multi_list}).catch(function(e){t.$config.err_notice(t,e)})}},{key:"refreshForm",value:function(t){if(t){var e=this;this.reboot=setInterval(function(){e.refreshData(e.current)},5e3)}else clearInterval(this.reboot)}},{key:"queryData",value:function(){this.find.valve=!0,this.refreshData()}},{key:"queryCancel",value:function(){this.find=this.$config.clearPicker(this.find),this.current=1,this.refreshData()}},{key:"mounted",value:function(){this.refreshData(),this.refreshForm(this.valve)}},{key:"destroyed",value:function(){clearInterval(this.reboot)}}]),e}(Object(v["b"])(z["a"]));L=Object(l["a"])([Object(v["a"])({components:{audit_reject:j,audit_detail:q,audit_osc:W}})],L);var R=L,A=function(t){function e(){return Object(o["a"])(this,e),Object(i["a"])(this,Object(c["a"])(e).apply(this,arguments))}return Object(s["a"])(e,t),e}(v["d"]);A=Object(l["a"])([Object(v["a"])({components:{},mixins:[R]})],A);var M=A,P=M,Q=(n("f6a0"),Object(k["a"])(P,r,a,!1,null,"00fa7113",null));e["default"]=Q.exports},c622:function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Row",[n("Col",[n("code",[t._v(t._s(t.row.SQL))])])],1)},a=[],o={name:"expandTable",props:{row:Object}},i=o,c=n("2877"),s=Object(c["a"])(i,r,a,!1,null,"564f6147",null);e["a"]=s.exports},cd1c:function(t,e,n){var r=n("e853");t.exports=function(t,e){return new(r(t))(e)}},e853:function(t,e,n){var r=n("d3f4"),a=n("1169"),o=n("2b4c")("species");t.exports=function(t){var e;return a(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!a(e.prototype)||(e=void 0),r(e)&&(e=e[o],null===e&&(e=void 0))),void 0===e?Array:e}},f6a0:function(t,e,n){"use strict";var r=n("828e"),a=n.n(r);a.a}}]);
//# sourceMappingURL=chunk-6d8ecd78.0ba0e841.js.map